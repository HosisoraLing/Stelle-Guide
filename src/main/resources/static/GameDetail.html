<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>商品详情</title>
	<script src="js/jquery-1.12.4.js" type="text/javascript"></script>
	<script type="text/javascript" src="https://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
	<link rel="stylesheet" href="css/common.css">
	<link rel="stylesheet" href="css/detail.css">
	<link rel="stylesheet" href="css/Shopping.css"/>
	<style type="text/css">
		* {
			margin: 0px;
			padding: 0px;
		}

		body {
			background: url("images/bg.jpg") no-repeat fixed;
		}

		#qq {
			width: 600px;
			/*宽*/
			height: 170px;
			/*高*/
			background: #fff;
			/*背景颜色*/
			margin: 50px auto 30px;
			border-radius: 5px;
			/*Html5 圆角*/
		}

		#qq p {
			font-size: 12px;
			color: #666;
			font-family: "微软雅黑";
			line-height: 45px;
			text-indent: 20px;
		}

		#qq .message {
			width: 560px;
			height: 70px;
			margin: 0 auto;
			overflow: hidden;
			outline: none;
			border: 1px solid #ddd;
			padding: 8px;
			box-sizing: border-box;
			font-size: 14px;
			-webkit-background-clip: text;
			color: transparent;
			background-image: linear-gradient(to right, #778899 0%, #333 100%);
			/*粗细 风格 颜色*/
		}

		#qq .But {
			width: 560px;
			height: 35px;
			margin: 15px auto 0px;
			position: relative;
			/*相对，参考对象*/
		}

		#qq .But img.bq {
			float: left;
			/*左浮动*/
		}

		#qq .But span.submit {
			width: 80px;
			height: 30px;
			background: #ff8140;
			display: block;
			float: right;
			/*右浮动*/
			line-height: 30px;
			border-radius: 5px;
			cursor: pointer;
			/*手指*/
			color: #fff;
			font-size: 12px;
			text-align: center;
			font-family: "微软雅黑";
		}
		/*msgCon begin*/
		.msgCon {
			width: 600px;
			margin: 0px auto;
			margin-bottom: 60px;
		}

		.msgCon .msgBox {
			background: #fff;
			padding: 10px;
			box-sizing: border-box;
			margin-top: 16px;
			border-radius: 4px;
		}

		.msgCon .msgBox .headUrl {
			width: 100%;
			height: 60px;
			border-bottom: 1px dotted #ddd;
			display: flex;
			align-items: center;
		}

		.msgCon .msgBox .headUrl img {
			width: 46px;
			height: 46px;
			border-radius: 50%
		}

		.msgCon .msgBox .headUrl div {
			flex: 1;
			display: flex;
			flex-flow: column;
			font-size: 16px;
			margin-left: 16px;
			-webkit-background-clip: text;
			color: transparent;
			background-image: linear-gradient(to top, #b224ef 0%, #7579ff 100%);
		}

		.msgCon .msgBox .headUrl div .time {
			font-size: 14px;
			margin-top: 6px;
			-webkit-background-clip: text;
			color: transparent;
			background-image: linear-gradient(to right, #74ebd5 0%, #9face6 100%);
		}

		.msgCon .msgBox .headUrl a {
			font-size: 14px;
			padding: 10px;
			color: salmon;
			cursor: pointer;
		}

		.msgCon .msgBox .msgTxt {
			font-size: 14px;
			color: #666;
			min-height: 40px;
			line-height: 24px;
			padding: 10px;
			box-sizing: border-box;
			word-wrap: break-word;
			-webkit-background-clip: text;
			color: transparent;
			background-image: linear-gradient(to right, #778899 0%, #333 100%);
		}
	</style>
</head>
<body>
<div id="all">

	<div style="clear: both;"></div>
	<div id="content">
		<div class="a1">
			<img class="big" id="movieImg" src="img/cake1_big.jpg">
		</div>
		<div class="a2">
			<p id="movieName">提拉米苏(约2磅)</p>
			<div class="a21">
				<div class="a211">
					<span class="color">售价</span>
					<span class="prices">￥198</span>
					<span class="shic">市场价<span class="prices2">￥338</span></span>
					<span class="yis">已售6264件</span>
				</div>
				<div class="a22">
					<p></p>
					<span class="color">详情</span>
					<span class="neir" id="movieXiangqing">鸡蛋、奶油、小麦粉、芒果、榴莲肉、巧克力、干酪</span>
				</div>

				<div id="div_box-right-7"  onselectstart="return false;">
					<span>数量</span>
					<div id="div_box-right-7-div-1">1</div>
					<div id="div_box-right-7-div-2">
						<div id="div_box-right-7-div-2-onck1">
							<svg t="1588663432940" style="width: 0.7em;height: 0.7em;font-weight: 700;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2160" width="200" height="200"><path d="M511.867 399.019l292.16 292.155c12.27 12.28 32.186 12.28 44.457 0 12.28099999-12.27 12.281-32.186 0-44.457l-314.388-314.388c-12.27-12.28-32.186-12.28-44.457 0l-314.387 314.388c-6.14 6.136-9.211 14.183-9.211 22.228s3.071 16.092 9.21099999 22.228c12.27 12.28 32.186 12.28 44.45700001 1e-8l292.159-292.15500001z" p-id="2161" fill="#bfbfbf"></path></svg>
						</div>
						<div id="div_box-right-7-div-2-onck2">
							<svg t="1588663543242" style="width: 0.7em;height: 0.7em;font-weight: 700;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2343" width="200" height="200"><path d="M512.133 624.981l-292.16-292.155c-12.27-12.28-32.186-12.28-44.457 0-12.281 12.27-12.281 32.186 0 44.457l314.388 314.388c12.27 12.28 32.186 12.28 44.457 0l314.387-314.388c6.14-6.136 9.211-14.183 9.211-22.228s-3.071-16.092-9.211-22.228c-12.27-12.28-32.186-12.28-44.457 0l-292.159 292.155z" p-id="2344" fill="#bfbfbf"></path></svg>
						</div>
					</div>
					<span style="position: absolute;left: 0;color: #838383;line-height: 43px;font-size: 12px;margin-left: 170px;float: left;">件</span>
				</div>

				<div class="a25" onclick="addByCar()">
					<a href="#">
						<button class="a25color1">加入购物车</button>
					</a>
					<a href="#">
						<button class="a25color2">加入购物车</button>
					</a>
				</div>
			</div>
		</div>
	</div>
	<div style="clear: both;"></div>

</div>

<!--添加评论-->
<div id="qq">
	<p>有什么新鲜事想告诉大家?</p>
	<div class="message" contentEditable='true'></div>
	<div class="But">
		<img src="./images/bba_thumb.gif" class='bq' />
		<span class='submit' onclick="addComment()">发表</span>
		<input>
	</div>
</div>

<!--msgCon begin显示评论-->
<div class="msgCon">
	<div class='msgBox'>
		<div class="headUrl">
			<img src='./images/tx.jpg' width='50' height='50'>
			<div>
				<span class="title">木林森里没有木</span>
				<span class="time">2018-01-01</span>
			</div>
			<a class="del">删除</a>
		</div>
		<div class='msgTxt'>
			${item.msg}
		</div>
	</div>
</div>

</body>
<script type="text/javascript" src="./js/NumberOfClothes.js"></script>
<script>

	//渲染html
	// function innerHTMl(List) {
	//     List = List || []
	//     List.forEach(item => {
	//         let str =
	//             `<div class='msgBox'>
	// 				<div class="headUrl">
	// 					<img src='images/tx.jpg' width='50' height='50'>
	// 					<div>
	// 						<span class="title">木林森里没有木</span>
	// 						<span class="time">2018-01-01</span>
	// 					</div>
	// 					<a class="del">删除</a>
	// 				</div>
	// 				<div class='msgTxt'>
	// 					${item.msg}
	// 				</div>
	// 			</div>`
	//         $(".msgCon").prepend(str);
	//     })
	// }

	//获取请求的路径
	function getUrlParam(name){
		//
		var reg = new RegExp("(^|&)"+name+"=([^&]*)(&|$)");
		//保存地址栏那个请求的参数
		var r = window.location.search.substr(1).match(reg);
		if (r!=null){
			//解密链接
			return unescape(r[2]);

		}else {
			return null;
		}
	}

	$(function (){
		var mid = getUrlParam("mid");
		//发送请求，通过mid查询电影数据
		$.get("/getOneMovie",{"mid":mid},function (data){
			console.log(data);
			$("#movieImg").attr("src",data.img)
			$("#movieName").text(data.title)
			$("#movieXiangqing").text(data.msg)
		})

		showComment();
	})

	function addByCar(){
		var uid;
		var mid = getUrlParam("mid");
		var number = 7;//Number($(".bang").text());
		$.get("/getUser",null,function (data){
			uid = data.uid;
			alert("添加到购物车"+"电影id:"+mid+"数量:"+number+"用户id："+uid)
			//if (uid!=null){
			$.get("/addBuyCar",{"uid":uid,"mid":mid,"number":number},function (data){
				alert(data)
			})

			//}else {
			//   alert("请登录")
			// location.href = "MovieDetail.html?mid="+mid;
			//}
		})
	}

	function addComment(){
		var uid;
		var mid = getUrlParam("mid");
		var content = $(".message").val();
		$.get("/getUser",null,function (data){
			uid = data.uid;
			if (uid!=null){
				alert("用户"+uid+"电影"+uid+"评论"+content)
				$.get("/addComment",{"uid":uid,"mid":mid,"content":content},function (data){
					alert("data")
				})
			} else {
				alert("请登录")
				location.href = "MovieDetail.html?mid="+mid;
			}
		})
	}

	function showComment(){
		var mid = getUrlParam("mid");
		$.get("/showComment",{"mid":mid},function (data){
			console.log(data)
			var tbody="";
			for (var i=0;i<data.length;i++){
				// $($(".title")[i]).text(data[i].username)
				// $($(".msgTxt")[i]).text(data[i].content)
				tbody+="<div class=\"headUrl\">" +
						"<img src='images/tx.jpg' width='50' height='50'>" +
						"<div>" +
						"<span class=\"title\">木林森里没有木</span>" +
						"<span class=\"time\">2018-01-01</span>" +
						"</div>" +
						"<a class=\"del\">删除</a>" +
						"</div>" +
						"<div class='msgTxt'>" +
						"${item.msg}" +
						"</div>"
			}
			$(".msgBox").html(tbody);
			showComment();
		})
	}
</script>
</html>
