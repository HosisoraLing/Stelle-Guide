<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title id="webTitle">星穹指南</title>
	<script src="js/jquery-1.12.4.js" type="text/javascript"></script>
	<script type="text/javascript" src="https://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
	<link rel="stylesheet" href="css/common.css">
	<link rel="stylesheet" href="css/detail.css">
	<link rel="stylesheet" href="css/Shopping.css"/>
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/comment.css">
	<link type="text/css" href="css/style2.css" rel="stylesheet" />

	<script src="https://www.jq22.com/jquery/jquery-1.10.2.js"></script>
	<script type="text/javascript" src="js/script.js"></script>
	<meta name="referrer" content="no-referrer">
	<style type="text/css">
		* {
			margin: 0px;
			padding: 0px;
		}

		body {

		}
		.xzw_starSys{
			position: relative;
			margin-left: 500px;
		}
		#qq {
			width: 600px;
			/*宽*/
			height: 170px;
			/*高*/
			background: #fff;
			/*背景颜色*/
			margin: 50px auto 30px;
			border-radius: 5px;
			/*Html5 圆角*/
		}

		#qq p {
			font-size: 12px;
			color: #666;
			font-family: "微软雅黑";
			line-height: 45px;
			text-indent: 20px;
		}

		#qq .message {
			width: 560px;
			height: 70px;
			margin: 0 auto;
			overflow: hidden;
			outline: none;
			border: 1px solid #ddd;
			padding: 8px;
			box-sizing: border-box;
			font-size: 14px;
			-webkit-background-clip: text;
			color: transparent;
			background-image: linear-gradient(to right, #778899 0%, #333 100%);
			/*粗细 风格 颜色*/
		}

		#qq .But {
			width: 560px;
			height: 35px;
			margin: 15px auto 0px;
			position: relative;
			/*相对，参考对象*/
		}

		#qq .But img.bq {
			float: left;
			/*左浮动*/
		}

		#qq .But span.submit {
			width: 80px;
			height: 30px;
			background: #ff8140;
			display: block;
			float: right;
			/*右浮动*/
			line-height: 30px;
			border-radius: 5px;
			cursor: pointer;
			/*手指*/
			color: #fff;
			font-size: 12px;
			text-align: center;
			font-family: "微软雅黑";
		}
		/*msgCon begin*/
		.msgCon {
			width: 600px;
			margin: 0px auto;
			margin-bottom: 60px;
		}

		.msgCon .msgBox {
			background: #fff;
			padding: 10px;
			box-sizing: border-box;
			margin-top: 16px;
			border-radius: 4px;
		}

		.msgCon .msgBox .headUrl {
			width: 100%;
			height: 60px;
			border-bottom: 1px dotted #ddd;
			display: flex;
			align-items: center;
		}

		.msgCon .msgBox .headUrl img {
			width: 46px;
			height: 46px;
			border-radius: 50%
		}

		.msgCon .msgBox .headUrl div {
			flex: 1;
			display: flex;
			flex-flow: column;
			font-size: 16px;
			margin-left: 16px;
			-webkit-background-clip: text;
			color: transparent;
			background-image: linear-gradient(to top, #b224ef 0%, #7579ff 100%);
		}

		.msgCon .msgBox .headUrl div .time {
			font-size: 14px;
			margin-top: 6px;
			-webkit-background-clip: text;
			color: transparent;
			background-image: linear-gradient(to right, #74ebd5 0%, #9face6 100%);
		}

		.msgCon .msgBox .headUrl a {
			font-size: 14px;
			padding: 10px;
			color: salmon;
			cursor: pointer;
		}

		.msgCon .msgBox .msgTxt {
			font-size: 14px;
			color: #666;
			min-height: 40px;
			line-height: 24px;
			padding: 10px;
			box-sizing: border-box;
			word-wrap: break-word;
			-webkit-background-clip: text;
			color: transparent;
			background-image: linear-gradient(to right, #778899 0%, #333 100%);
		}
		.title{
			font-size: 40px;
			font-weight: bolder;
		}
		.pricess{
			font-size: 30px;
			font-weight: bolder;
		}
		.engtitle{
			font-size: 20px;
			font-weight: bold;
		}
	</style>
</head>
<body>
<div id="all">
	<div>
		<p style="font-size: 20px;text-align: right;background-color: gray">欢迎：<image width='30' height='30' id="avatar0" style=""></image><a href="" id="nickname0" target="_blank"></a> <a href="/logOut">注销</a></p>
		<script>
			$.get("/getUser",null,function (data){

				if(data.nickname!=null) {
					$ ("#nickname0").html (data.nickname);

					$ ("#nickname0").attr ("href", "/space.html?uid=" + data.uid)
				}else {
					$ ("#nickname0").text ("尚未登录");

					$ ("#nickname0").attr ("href", "index.html")
				}
				$("#avatar0").attr("src",data.avatar)
			})
		</script>
	</div>
	<div style="clear: both;"></div>
	<div id="content">
		<div class="a1">
			<img class="big" id="gameCover" src="">
		</div>
		<div class="a2">
			<p id="gameName" class="title"></p><p id="pinfeng" style="text-align:right; text-size:35px ; color: red"></p>
			<p id="englishName" class="engtitle"></p>
			<div class="a21">
				<div class="a211">
					<span class="color pricess">售价</span>
					<span class="prices" id="Price">￥198</span>
					<div id="yuanjia">
					<span class="shic"><br>原价<span class="prices2" id="msrp"></span></span>
					</div>
					<div id="SaleRatio"></div>
					<span class="yis" id="atlprice">历史最低：</span>
					<span id="ratings"></span>
				</div>
				<div class="a22">
					<p></p>
					<span class="color">详情</span>
					<span class="neir" id="gameIntro"></span>
				</div>


			</div>
		</div>
	</div>
	<div style="clear: both;"></div>

</div>

<!--<<div class="commentAll">-->
<!--	&lt;!&ndash;评论区域 begin&ndash;&gt;-->
<!--	<div class="reviewArea clearfix">-->
<!--		<textarea class="content comment-input" placeholder="Please enter a comment&hellip;" onkeyup="keyUP(this)"></textarea>-->
<!--		<a href="javascript:;" class="plBtn">评论</a>-->
<!--	</div>-->
<!--	&lt;!&ndash;评论区域 end&ndash;&gt;-->
<!--	&lt;!&ndash;回复区域 begin&ndash;&gt;-->
<!--	<div class="comment-show">-->
<!--		<div class="comment-show-con clearfix">-->
<!--			<div class="comment-show-con-img pull-left"><img src="images/header-img-comment_03.png" alt=""></div>-->
<!--			<div class="comment-show-con-list pull-left clearfix">-->
<!--				<div class="pl-text clearfix">-->
<!--					<a href="#" class="comment-size-name" id="nickname">张三 : </a>-->
<!--					<span class="my-pl-con" id="commentContent">&nbsp;来啊 造作啊!</span>-->
<!--				</div>-->
<!--				<div class="date-dz">-->
<!--					<span class="date-dz-left pull-left comment-time" id="commentTime">2017-5-2 11:11:39</span>-->
<!--					<div class="date-dz-right pull-right comment-pl-block">-->
<!--						<a href="javascript:;" class="removeBlock">删除</a>-->
<!--						<a href="javascript:;" class="date-dz-pl pl-hf hf-con-block pull-left">回复</a>-->
<!--						<span class="pull-left date-dz-line">|</span>-->
<!--						<a href="javascript:;" class="date-dz-z pull-left"><i class="date-dz-z-click-red"></i>赞 (<i class="z-num" id="likes-num">666</i>)</a>-->
<!--					</div>-->
<!--				</div>-->
<!--				<div class="hf-list-con"></div>-->
<!--			</div>-->
<!--		</div>-->
<!--	</div>-->
<!--	&lt;!&ndash;回复区域 end&ndash;&gt;-->
<!--</div>-->

<!--<script type="text/javascript" src="js/jquery-1.12.0.min.js"></script>-->
<!--<script type="text/javascript" src="js/jquery.flexText.js"></script>-->
<!--&lt;!&ndash;textarea高度自适应&ndash;&gt;-->
<!--<script type="text/javascript">-->
<!--	$(function () {-->
<!--		$('.content').flexText();-->
<!--	});-->
<!--</script>-->
<!--&lt;!&ndash;textarea限制字数&ndash;&gt;-->
<!--<script type="text/javascript">-->
<!--	function keyUP(t){-->
<!--		var len = $(t).val().length;-->
<!--		if(len > 139){-->
<!--			$(t).val($(t).val().substring(0,140));-->
<!--		}-->
<!--	}-->
<!--</script>-->
<!--&lt;!&ndash;点击评论创建评论条&ndash;&gt;-->
<!--<script type="text/javascript">-->
<!--	$('.commentAll').on('click','.plBtn',function(){-->
<!--		var myDate = new Date();-->
<!--		//获取当前年-->
<!--		var year=myDate.getFullYear();-->
<!--		//获取当前月-->
<!--		var month=myDate.getMonth()+1;-->
<!--		//获取当前日-->
<!--		var date=myDate.getDate();-->
<!--		var h=myDate.getHours();       //获取当前小时数(0-23)-->
<!--		var m=myDate.getMinutes();     //获取当前分钟数(0-59)-->
<!--		if(m<10) m = '0' + m;-->
<!--		var s=myDate.getSeconds();-->
<!--		if(s<10) s = '0' + s;-->
<!--		var now=year+'-'+month+"-"+date+" "+h+':'+m+":"+s;-->
<!--		//获取输入内容-->
<!--		var oSize = $(this).siblings('.flex-text-wrap').find('.comment-input').val();-->
<!--		console.log(oSize);-->
<!--		var gid = getUrlParam("gid");-->
<!--		uid=0;-->
<!--		$.get("/getUid",null,function (data){-->
<!--			uid=data-->
<!--		})-->
<!--		var rating={-->
<!--			"time":now,-->
<!--			"gid":gid,-->
<!--			"uid":uid,-->
<!--			"comment":oSize-->
<!--		};-->
<!--		console.log(rating);-->
<!--		$.get("/addComment",rating,function (data){-->
<!--			if (data=="添加成功"){-->
<!--				oHtml = '<div class="comment-show-con clearfix"><div class="comment-show-con-img pull-left"><img src="images/header-img-comment_03.png" alt=""></div> <div class="comment-show-con-list pull-left clearfix"><div class="pl-text clearfix"> <a href="#" class="comment-size-name">David Beckham : </a> <span class="my-pl-con">&nbsp;'+ oSize +'</span> </div> <div class="date-dz"> <span class="date-dz-left pull-left comment-time">'+now+'</span> <div class="date-dz-right pull-right comment-pl-block"><a href="javascript:;" class="removeBlock">删除</a> <a href="javascript:;" class="date-dz-pl pl-hf hf-con-block pull-left">回复</a> <span class="pull-left date-dz-line">|</span> <a href="javascript:;" class="date-dz-z pull-left"><i class="date-dz-z-click-red"></i>赞 (<i class="z-num">666</i>)</a> </div> </div><div class="hf-list-con"></div></div> </div>';-->
<!--				if(oSize.replace(/(^\s*)|(\s*$)/g, "") != ''){-->
<!--					$(this).parents('.reviewArea ').siblings('.comment-show').prepend(oHtml);-->
<!--					$(this).siblings('.flex-text-wrap').find('.comment-input').prop('value','').siblings('pre').find('span').text('');-->
<!--		 		}-->
<!--			}else {-->
<!--				alert(data);-->
<!--			}-->
<!--		})-->
<!--		//动态创建评论模块-->

<!--	});-->
<!--</script>-->
<!--&lt;!&ndash;点击回复动态创建回复块&ndash;&gt;-->
<!--<script type="text/javascript">-->
<!--	$('.comment-show').on('click','.pl-hf',function(){-->
<!--		//获取回复人的名字-->
<!--		var fhName = $(this).parents('.date-dz-right').parents('.date-dz').siblings('.pl-text').find('.comment-size-name').html();-->
<!--		//回复@-->
<!--		var fhN = '回复@'+fhName;-->
<!--		//var oInput = $(this).parents('.date-dz-right').parents('.date-dz').siblings('.hf-con');-->
<!--		var fhHtml = '<div class="hf-con pull-left"> <textarea class="content comment-input hf-input" placeholder="" onkeyup="keyUP(this)"></textarea> <a href="javascript:;" class="hf-pl">评论</a></div>';-->
<!--		//显示回复-->
<!--		if($(this).is('.hf-con-block')){-->
<!--			$(this).parents('.date-dz-right').parents('.date-dz').append(fhHtml);-->
<!--			$(this).removeClass('hf-con-block');-->
<!--			$('.content').flexText();-->
<!--			$(this).parents('.date-dz-right').siblings('.hf-con').find('.pre').css('padding','6px 15px');-->
<!--			//console.log($(this).parents('.date-dz-right').siblings('.hf-con').find('.pre'))-->
<!--			//input框自动聚焦-->
<!--			$(this).parents('.date-dz-right').siblings('.hf-con').find('.hf-input').val('').focus().val(fhN);-->
<!--		}else {-->
<!--			$(this).addClass('hf-con-block');-->
<!--			$(this).parents('.date-dz-right').siblings('.hf-con').remove();-->
<!--		}-->
<!--	});-->
<!--</script>-->
<!--&lt;!&ndash;评论回复块创建&ndash;&gt;-->
<!--<script type="text/javascript">-->
<!--	$('.comment-show').on('click','.hf-pl',function(){-->
<!--		var oThis = $(this);-->
<!--		var myDate = new Date();-->
<!--		//获取当前年-->
<!--		var year=myDate.getFullYear();-->
<!--		//获取当前月-->
<!--		var month=myDate.getMonth()+1;-->
<!--		//获取当前日-->
<!--		var date=myDate.getDate();-->
<!--		var h=myDate.getHours();       //获取当前小时数(0-23)-->
<!--		var m=myDate.getMinutes();     //获取当前分钟数(0-59)-->
<!--		if(m<10) m = '0' + m;-->
<!--		var s=myDate.getSeconds();-->
<!--		if(s<10) s = '0' + s;-->
<!--		var now=year+'-'+month+"-"+date+" "+h+':'+m+":"+s;-->
<!--		//获取输入内容-->
<!--		var oHfVal = $(this).siblings('.flex-text-wrap').find('.hf-input').val();-->
<!--		console.log(oHfVal)-->
<!--		var oHfName = $(this).parents('.hf-con').parents('.date-dz').siblings('.pl-text').find('.comment-size-name').html();-->
<!--		var oAllVal = '回复@'+oHfName;-->
<!--		if(oHfVal.replace(/^ +| +$/g,'') == '' || oHfVal == oAllVal){-->

<!--		}else {-->
<!--			$.getJSON("json/pl.json",function(data){-->
<!--				var oAt = '';-->
<!--				var oHf = '';-->
<!--				$.each(data,function(n,v){-->
<!--					delete v.hfContent;-->
<!--					delete v.atName;-->
<!--					var arr;-->
<!--					var ohfNameArr;-->
<!--					if(oHfVal.indexOf("@") == -1){-->
<!--						data['atName'] = '';-->
<!--						data['hfContent'] = oHfVal;-->
<!--					}else {-->
<!--						arr = oHfVal.split(':');-->
<!--						ohfNameArr = arr[0].split('@');-->
<!--						data['hfContent'] = arr[1];-->
<!--						data['atName'] = ohfNameArr[1];-->
<!--					}-->

<!--					if(data.atName == ''){-->
<!--						oAt = data.hfContent;-->
<!--					}else {-->
<!--						oAt = '回复<a href="#" class="atName">@'+data.atName+'</a> : '+data.hfContent;-->
<!--					}-->
<!--					oHf = data.hfName;-->
<!--				});-->

<!--				var oHtml = '<div class="all-pl-con"><div class="pl-text hfpl-text clearfix"><a href="#" class="comment-size-name">我的名字 : </a><span class="my-pl-con">'+oAt+'</span></div><div class="date-dz"> <span class="date-dz-left pull-left comment-time">'+now+'</span> <div class="date-dz-right pull-right comment-pl-block"> <a href="javascript:;" class="removeBlock">删除</a> <a href="javascript:;" class="date-dz-pl pl-hf hf-con-block pull-left">回复</a> <span class="pull-left date-dz-line">|</span> <a href="javascript:;" class="date-dz-z pull-left"><i class="date-dz-z-click-red"></i>赞 (<i class="z-num">666</i>)</a> </div> </div></div>';-->
<!--				oThis.parents('.hf-con').parents('.comment-show-con-list').find('.hf-list-con').css('display','block').prepend(oHtml) && oThis.parents('.hf-con').siblings('.date-dz-right').find('.pl-hf').addClass('hf-con-block') && oThis.parents('.hf-con').remove();-->
<!--			});-->
<!--		}-->
<!--	});-->
<!--</script>-->
<!--&lt;!&ndash;删除评论块&ndash;&gt;-->
<!--<script type="text/javascript">-->
<!--	$('.commentAll').on('click','.removeBlock',function(){-->
<!--		var oT = $(this).parents('.date-dz-right').parents('.date-dz').parents('.all-pl-con');-->
<!--		if(oT.siblings('.all-pl-con').length >= 1){-->
<!--			oT.remove();-->
<!--		}else {-->
<!--			$(this).parents('.date-dz-right').parents('.date-dz').parents('.all-pl-con').parents('.hf-list-con').css('display','none')-->
<!--			oT.remove();-->
<!--		}-->
<!--		$(this).parents('.date-dz-right').parents('.date-dz').parents('.comment-show-con-list').parents('.comment-show-con').remove();-->

<!--	})-->
<!--</script>-->
<!--&lt;!&ndash;点赞&ndash;&gt;-->
<!--<script type="text/javascript">-->
<!--	$('.comment-show').on('click','.date-dz-z',function(){-->
<!--		var zNum = $(this).find('.z-num').html();-->
<!--		if($(this).is('.date-dz-z-click')){-->
<!--			zNum&#45;&#45;;-->
<!--			$(this).removeClass('date-dz-z-click red');-->
<!--			$(this).find('.z-num').html(zNum);-->
<!--			$(this).find('.date-dz-z-click-red').removeClass('red');-->
<!--		}else {-->
<!--			zNum++;-->
<!--			$(this).addClass('date-dz-z-click');-->
<!--			$(this).find('.z-num').html(zNum);-->
<!--			$(this).find('.date-dz-z-click-red').addClass('red');-->
<!--		}-->
<!--	})-->
<!--</script>-->
<!--添加评论-->
<!--代码开始-->
<div class="xzw_starSys">
	<div class="xzw_starBox">
		<ul class="star stars">
			<li><a href="javascript:void(0)" rate="1" title="1" class="one-star">1</a></li>
			<li><a href="javascript:void(0)" rate="2" title="2" class="two-stars">2</a></li>
			<li><a href="javascript:void(0)" rate="3" title="3" class="three-stars">3</a></li>
			<li><a href="javascript:void(0)" rate="4" title="4" class="four-stars">4</a></li>
			<li><a href="javascript:void(0)" rate="5" title="5" class="five-stars">5</a></li>
		</ul>
		<div class="current-rating showb"></div>
	</div>
	<!--评价文字-->
	<div class="description"></div>
	<!--评价选项-->
	<div class="option">
		<ul class="option-con clearfix">
			<li><a href="">依托答辩</a></li>
			<li><a href="">剧情狗屁不通</a></li>
			<li><a href="">画面不堪入目</a></li>
			<li><a href="">完全没有乐趣</a></li>
			<li><a href="">开发商恶心人</a></li>
		</ul>
		<ul class="option-con clearfix" style="display:none">
			<li><a href="">制作水平有待提高</a></li>
			<li><a href="">剧情平淡无趣</a></li>
			<li><a href="">玩法缺乏乐趣</a></li>
			<li><a href="">BUG满天飞</a></li>
			<li><a href="">十分无聊</a></li>
		</ul>
		<ul class="option-con clearfix" style="display:none">
			<li><a href="">中规中矩</a></li>
			<li><a href="">瑕不掩瑜</a></li>
			<li><a href="">存在部分问题</a></li>
			<li><a href="">可圈可点</a></li>
			<li><a href="">体验尚可</a></li>
		</ul>
		<ul class="option-con clearfix" style="display:none">
			<li><a href="">出色的作品</a></li>
			<li><a href="">优秀的剧情</a></li>
			<li><a href="">精美的画面</a></li>
			<li><a href="">有趣的玩法</a></li>
			<li><a href="">快乐的体验</a></li>
		</ul>
		<ul class="option-con clearfix" style="display:none">
			<li><a href="">世不二出的奇迹</a></li>
			<li><a href="">出色的第九艺术</a></li>
			<li><a href="">完美的剧情</a></li>
			<li><a href="">流连忘返的旅行</a></li>
			<li><a href="">第二人生</a></li>
		</ul>
	</div>
	<div class="prompt">请为该游戏打分</div>
</div>
<!--代码结束-->
<div id="qq">
	<p>在下面输入对游戏的评价（虽然没有竖线但是确实可以正确输入的）</p>
	<div class="message" id="commentbox" contentEditable='true'></div>
	<div class="But">

		<span class='submit' onclick="addComment()">发表</span>

	</div>
</div>

<!--msgCon begin显示评论-->
<div class="msgCon">
	<div class='msgBox'>
		<div class="headUrl">
			<img src='./images/tx.jpg' width='50' height='50'>
			<div>
				<span class="title"></span>
				<span class="time"></span>
			</div>
			<a class="del">删除</a>
		</div>
		<div class='msgTxt'>
			${item.msg}
		</div>
	</div>
</div>



</body>
<script type="text/javascript" src="./js/NumberOfClothes.js"></script>
<script>

	//渲染html
	// function innerHTMl(List) {
	//     List = List || []
	//     List.forEach(item => {
	//         let str =
	//             `<div class='msgBox'>
	// 				<div class="headUrl">
	// 					<img src='images/tx.jpg' width='50' height='50'>
	// 					<div>
	// 						<span class="title">木林森里没有木</span>
	// 						<span class="time">2018-01-01</span>
	// 					</div>
	// 					<a class="del">删除</a>
	// 				</div>
	// 				<div class='msgTxt'>
	// 					${item.msg}
	// 				</div>
	// 			</div>`
	//         $(".msgCon").prepend(str);
	//     })
	// }

	//获取请求的路径
	function getUrlParam(name){
		//
		var reg = new RegExp("(^|&)"+name+"=([^&]*)(&|$)");
		//保存地址栏那个请求的参数
		var r = window.location.search.substr(1).match(reg);
		if (r!=null){
			//解密链接
			return unescape(r[2]);

		}else {
			return null;
		}
	}
	rate=-1//存储打星的变量，默认-1表示没有打分
	$(function (){

		var gid = getUrlParam("gid");
		//发送请求，通过gid查询游戏数据
		$.get("/getGameById",{"gid":gid},function (data){
			console.log(data);
			$("#gameCover").attr("src",data.cover)
			$("#gameName").text(data.chinesetitle)
			$("#gameIntro").text(data.info)
			$("#webTitle").text(data.chinesetitle+"|星穹指南")
			$("#msrp").text(data.defaultprice)
			$("#englishName").text(data.englishtitle)
			var pinfeng=0.0;
			pinfeng=data.rating;
			pinfeng=pinfeng.toFixed(1);
			$("#pinfeng").text(pinfeng)
			if(data.alltimelowprice==0){
				$("#atlprice").text("历史最低：免费开玩！")
			}else {
				$("#atlprice").text("历史最低："+data.alltimelowprice)
			}
			$.get("/getCurrentPrice",{"gid":gid},function (data2){
				if(data2!=0){
					$("#Price").text(data2)
					var t = document.getElementById('SaleRatio');//选取id为SaleRatio的div元素// 隐藏元素
					t.style.visibility = 'hidden';
					var a = document.getElementById('yuanjia');//选取id为SaleRatio的div元素// 隐藏元素
					a.style.visibility = 'visible';
					if(data.defaultprice!=data2){
						var t = document.getElementById('SaleRatio');//选取id为SaleRatio的div元素// 隐藏元素
						t.style.visibility = 'visible';// 显示元素
						var ratio=0.0;
						ratio = (((data.defaultprice-data2)/data.defaultprice)*100)
						ratio = ratio.toFixed(1);
						if (ratio>0){
							$("#SaleRatio").text("-"+ratio+"%")
							t.style.color = "green";
						}else {
							$("#SaleRatio").text("+"+ratio+"%")
							t.style.color = "red";
						}

					}else {
						var t = document.getElementById('SaleRatio');//选取id为SaleRatio的div元素// 隐藏元素
						t.style.visibility = 'hidden';
					}
				}else {
					var t = document.getElementById('SaleRatio');//选取id为SaleRatio的div元素// 隐藏元素
					t.style.visibility = 'hidden';
					$("#Price").text("免费开玩！");
					var a = document.getElementById('yuanjia');//选取id为SaleRatio的div元素// 隐藏元素
					a.style.visibility = 'hidden';
				}

			})

		})
		showComment()
		var li = document.getElementsByTagName("li");
		for(let i=0; i<li.length; i++) {
			li[i].onclick = function (){
				rate=i+1
			}
		}
	})



	function addComment(){
		var date=new Date();
		var mytime=date.toLocaleString();
		console.log("获取到时间："+mytime)
		var gid = getUrlParam("gid");
		var content =document.getElementById('commentbox').innerHTML
		console.log(content)
		if(rate==-1){
			alert("您还没有打分")
			location.href = "GameDetail.html?gid="+gid;
		}else {
			$.get("/getUser",null,function (data){
				var uid = data.uid;
				if (uid!=null){
					console.log("用户："+uid+" 游戏："+gid+" 评论："+content)
					$.get("/addComment",{"uid":uid,"avatar":data.avatar,"nickname":data.nickname,"time":mytime,"gid":gid,"comment":content,"rating":rate},function (data){
						showComment()
					})
					$.get("/updateRating", {gid:gid, rating:rate},function (data){
						alert(data)
					})
					$("#commentbox").text("")
				} else {
					alert("请登录")
					location.href = "GameDetail.html?gid="+gid;
					window.open("index.html")
				}
			})
		}



	}

	function showComment(){
		var gid = getUrlParam("gid");
		$.get("/showComment",{"gid":gid},function (data){
			console.log(data)
			var tbody="";
			for (var i=0;i<data.length;i++){
				// $($(".title")[i]).text(data[i].username)
				// $($(".msgTxt")[i]).text(data[i].content)

				tbody+="<div class=\"headUrl\">" +
						"<img src='"+data[i].avatar+"' width='50' height='50'>" +
						"<div>" +
						"<span class=\"title\" style='text-size:20px'>"+data[i].nickname+"</span>" +"<span class=\"rate\" style='color: red'>评分："+data[i].rating+"</span>" +
						"<span class=\"time\">"+data[i].time+"</span>" +
						"</div>" +
						"<a class=\"del\">删除</a>" +
						"</div>" +
						"<div class='msgTxt'>"+
						data[i].comment+
						"</div> <hr><br>"
			}
			$(".msgBox").html(tbody);

		})
	}
</script>
</html>
